<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/tr/xhtml1/DTD/xhtml1-transitional.dtd"> 
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"> 
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="css/themes/3000ms.css" />
    <link rel="stylesheet" href="css/themes/base.css" />
    <link rel="stylesheet" href="css/themes/jquery.mobile.icons.min.css" />
    <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.2/jquery.mobile.structure-1.4.2.min.css" />

    <script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
    <script type="text/javascript" src="jquery.timer.js"></script>
    <script src="http://code.jquery.com/mobile/1.4.2/jquery.mobile-1.4.2.min.js"></script>
    <script type="text/javascript">

        function pad(number, length) {
            var str = '' + number;
            while (str.length < length) {str = '0' + str;}
            return str;
        }
        function formatTime(time) {
            // this function can be rewritten per the parameters desired to be achieved
            var min = parseInt(time / 6000),
                sec = parseInt(time / 100) - (min * 60),
                hundredths = pad(time - (sec * 100) - (min * 6000), 2);
                console.log("time passed = "+time+" h val = "+hundredths);
            return (min > 0 ? pad(min, 2) : "00") + ":" + pad(sec, 2) + ":" + hundredths;
        }

        function forEachIn(object, action) {
            for (var property in object) {
            if (Object.prototype.hasOwnProperty.call(object, property))
                action(property, object[property]);
            }
        }
        function forEach(array, action) {
            for (var i = 0; i < array.length; i++)
            action(array[i]);
        }
        function commence(){
            ThurtySeconds.Timer.toggle();
            $('.statement').css("visibility", "visible");
            $('span').css("visibility", "visible");
            return false;
        }
        function teamToggle(){
            $('body').toggleClass("a b");
        }

        function resetClock(){
        // actually RESETS loads of STUFF
        // ** This function is doing too much, modularise it **
        // require a better solution
        // params to be reset { #second: visibility, clock: 00:00:00, div: pointer-events & opacity, allInput buttons: removeAttributes, checkboxradion, nextQuestions button: pointer-events&opacity }
            $('#second').hide(); // shouldn't be necessary, but just in case
            ThurtySeconds.resetCountdown();
            teamToggle();
            $('span').css("visibility", "hidden");
            $('div').css({"pointer-events": "auto", "opacity": "1"}); // all divs that had opacity altered reset
            $('#flip').css({"pointer-events": "none", "opacity": "0.6"}); //reset the flip button
            $(':input','#first').removeAttr('checked').checkboxradio("refresh");
            $(':input','#second').removeAttr('checked').checkboxradio("refresh");
            //$(':input').removeAttr('checked').checkboxradio("refresh"); // unknown why, but this throws error
            $('div').not('.ui-loader, #second').show();
            //$('#first').css("opacity", "0.2"); <- this line is death
            return false;
        }

        function nextQuestions(){
            $('#first').hide(); 
            // this is necessary at present only because the current parentsUntil logic hides all the divs within #first, but not #first
            console.log("this is flip");
            $('div').not('.ui-loader, #first').show(); // add additional qualifier class for hidden questions
        }

        function toggleRadio(){
            // this function is breaking things, if clicked the other two buttons dont function
            console.log($(':input','#first')); // returns an array of html objects
            forEachIn($(':input','#first'), function(k,v){console.log("is checked?"+v.checked);}); 
            $(':input','#first').removeAttr('checked').checkboxradio("refresh");
            $('div').not('.ui-loader').show();
            return false;
        }
// ** DECIDE WHICH OF THESE TO USE, also related to best practice **
//  above and below = same function
        $(function(){
            $('#toggle').click(function(){ // the below are bound to button with ID of toggle
                forEachIn($(':input','#first'), function(k,v){console.log("is checked?"+v.checked);});
                // works, see lines 199 - 204 for jQuery way of doing this
                $(':input','#first').removeAttr('checked').checkboxradio("refresh");
                // this removes checked attributes for all inputs in the first div
                // it calls a radio button specific repaint method 'checkboxradio()'
                    $('div').not('.ui-loader').show();
                    // this works, key to unhiding elements, shorter than above, not() rather than filter because I use parents until and wrapper divs to construct the questions
            });
        });

        var ThurtySeconds = new function() { // I have here amended from self invoking, and called init() outside
            var $countdown,
                $form, // Form used to change the countdown time
                incrementTime = 70,
                currentTime = 3000,
                updateTimer = function() {
                    $countdown.html(formatTime(currentTime)); // this function is purely for visual feedback
                    if (currentTime == 0) {
                        ThurtySeconds.Timer.stop();
                        timerComplete();
                        resetClock(); // this is better placed here than in subsequent resetCountdown function
                        ThurtySeconds.resetCountdown();
                        return;
                    }
                    // the below handles the business of counting down
                    currentTime -= incrementTime / 10;
                    if (currentTime < 0) currentTime = 0;
                },
                timerComplete = function() {
                    // .css(style="pointer-events:none;opacity:0.2") <-- not correct jQuery syntax, but the desired effect
                    alert('YOUR TURNS OVER! SCORE = ');
                    // goof place for the remove flip logic
                };
                this.init = function() {
                    console.log($countdown);
                    $countdown = $('#countdown');
                    console.log($countdown);
                    ThurtySeconds.Timer = $.timer(updateTimer, incrementTime, false);
                    $form = $('#ctrlButtons'); // its not fussy about what element it is bound to apparently
                    // however I will need to be fussy because this makes any button press reset the timer
                    $form.bind('submit', function() {
                        //ThurtySeconds.resetCountdown();
                        return false; // prevent resubmission of page behaviour default
                    });

                };
            this.resetCountdown = function() {

                var newTime = 3000; // 3000 = 30 seconds
                console.log(newTime);
                if (newTime > 0) {currentTime = newTime;}
                this.Timer.stop().once();
            };
        };

        $( document ).ready(function(){
        ThurtySeconds.init(); // initialise timer object

        var array = ["one","two","three","four","five"]; // need this to be an object I guess
            var JSON = [
                {'name':"one"},
                {'name':"two"},
                {'name':"three"},
                {'name':"four"},
                {'name':"five"},
                {'name':"six"},
                {'name':"seven"},
                {'name':"eight"},
                {'name':"nine"},
                {'name':"ten"}
                ];

            for(var x=0; x<JSON.length; x++){ //JSON.length
                // prepend the vals of array of objects to html elements with an ID selector matching object keys
                var elm = $("#"+JSON[x].name);
                console.log(elm);
                elm.prepend("<span>"+JSON[x].name+"</span>");
            }
            // set the first to invisible until the button is pressed
            $('.statement').css("visibility", "hidden"); // set to hidden until button
            console.log($('div','#second'));
            $('#second').hide();
        });

        $(function() {
            // this function is always awaiting change!
            $flip = 0;
            $(':input','#first').change(function(){ // this also works
            //$('input').change(function(){
                if($(this).context.checked = true) {
                    $flip++;
                        // conditional logic for checked value changge
                        if($(this).context.className == "guessed"){

                            $(this).parentsUntil( $('#first') ).hide(); // would be nice if identifier could be passed as param
                        } else if ($(this).context.className == "skip") {

                            $(this).parentsUntil( $('#first') ).css({"opacity": "0.6","pointer-events": "none"});
                        }
                }
                if($flip>= 5){ // permit press of the flip button, incorporation of prior permitFlip function
                    $('#flip').css({
                    "pointer-events": "auto",
                    "opacity": "1"
                    });
                }
            }); // end input.change for first
// ** this is an example of DRY - how can this be remedied given the manner in which jQuery selectors work **
            $(':input','#second').change(function(){
                console.log("an input click detected!");
                console.log($(this).context.checked);
                if($(this).context.checked = true) {

                        // conditional logic for checked value changge
                        if($(this).context.className == "guessed"){

                            $(this).parentsUntil( $('#second') ).hide(); // would be nice if identifier could be passed as param
                        } else if ($(this).context.className == "skip") {
                            $(this).parentsUntil( $('#second') ).css({"opacity": "0.6","pointer-events": "none"});
                        }
                }
            }); // end input.change for second
        }); // end function

    </script>
    <style type="text/css">
        .statement { /* this styling is essential controls display of questions*/
            height:20px;
            width:100%;
            display: inline-block;
            font-size: 20px;
            font-weight: bold;
            padding-right: 25px;
            text-shadow: 0px 1px 1px #fff;
            text-align:center;
        }
        .score {
            font-size: 15px;
            margin-right: 25px;
        }

        body.a {
        background-color: aqua;
        }
        body.b {
        background-color: burlywood;
        }
    </style>
</head>
<body class="a" data-role="page">
<div id="ctrlButtons">
    <span id="countdown">00:30:00</span>
    <form id="ThurtySeconds">

<!-- **RESEARCH - make informed decision WRT which button trigger method = jQuery best practice ** -->
<!-- these illustrate how you can access the timer functions contained within jQuery.timer directly via ThurtySeconds object
         <input type='button' value='Play/Pause' onclick='ThurtySeconds.Timer.toggle();' /> -->
        <!-- init function creates the Timer object-->
        <!-- <input type='button' value='Stop/Reset' onclick='ThurtySeconds.resetCountdown();' /> -->
    
            <!-- <fieldset class="ui-grid-d"> -->
            <!-- Buttons to Let the Games Begin! -->
            <div class="ui-block-c">
                <button class="ui-btn" onclick="return commence();">Start</button>
<!--                 i think this has pause functionality because .resetCountdown() is presently bound to all submit events
                and it contains a stop.once method -->
            </div>
            <div class="ui-block-c">
                <button id='flip' class="ui-btn" style="pointer-events:none;opacity:0.2" onclick="return nextQuestions()">Next Questions</button>
                <!-- <button class="ui-btn" onclick="return toggleRadio()">Toggle</button> trigger toggle via function bound to click in javascript convention-->
                 <!-- <input type='button' id='toggle' class="ui-btn" value='Toggle' /> 
                 trigger toggle via always on jQUery function that recognises change in state of DOM element and #id indentifier-->
            <br>
            </div>
            <div class="ui-block-a"></div>
            <div class="ui-block-c">
                <button class="ui-btn" value='Stop/Reset' onclick='return resetClock();'>Reset</button>
                <!-- the above isn't bound, and so reset countdown is triggered twice -->
                <!-- <input type='button' class="ui-btn" value='Reset Clock' onclick='ThurtySeconds.resetCountdown();'/> -->
            </div>
            <div class="ui-block-b">
            <ul class="score" id="teamA">SCORE A:</ul>
            <ul class="score" id="teamB">SCORE B:</ul>
            <!-- <div id="score">&nbsp;&nbsp;&nbsp;SCORE:</div> -->
            </div>
            <!-- entire body can be wrapped in fieldset-->
    </form>

</div> <!-- end control button DIV-->
   <!--  <fieldset class="ui-grid-a"> -->
<!-- fieldset may be outside first div, but not inside as it will hide everything with current
show() hide() conditional logic-->
        <div  id="first">

                <div style>
                <div id="one" class="statement"></div> <!-- these first are not parents of radio buttons because of the grid formatting issue. This means they cannot be accessed via parentsUntil, but a div above them can -->
                    <!-- <div id = "one" class="ui-block-a"></div> this can be used if statement desired to left of buttons-->
                    <div class="ui-block-b">
                <!--| alternative class designation = <input class="radio-input" |-->
                      <input class="guessed" id="guessed1" type="radio" name="guessed1" required="required">
                      <label for="guessed1">Guessed?</label>
                    </div>
                    <div class="ui-block-c">
                      <input class="skip" id="skip1" type="radio" name="skip1" required="required">
                      <label for="skip1">Skip?</label>
                    </div>
                </div> <!-- nameless div necessary to avail of parentsUntil logic-->

                <div style>
                    <div id="two" class="statement"></div>
                    <!-- <div id = "two" class="ui-block-a"></div> this can be used if statement desired to left of buttons -->
                    <div class="ui-block-b">
                      <input class="guessed" id="guessed2" type="radio" name="guessed2" required="required">
                      <label class="ui-mobile" name="guessed" for="guessed2">Guessed?</label>
                    </div>
                    <div class="ui-block-c">
                      <input class="skip" id="skip2" type="radio" name="skip2" required="required">
                      <label class="skip" name="skip" for="skip2">Skip?</label>
                    </div>
                </div>

                <div style>
                    <div id="three" class="statement"></div>
                        <!-- <div id = "three" class="ui-block-a"></div> this can be used if statement desired to left of buttons -->
                        <div class="ui-block-b">

                          <input class="guessed" id="guessed3" type="radio" name="guessed3" required="required">
                          <label class="ui-mobile" name="guessed" for="guessed3">Guessed?</label>
                        </div>
                        <div class="ui-block-c">
                          <input class="skip" id="skip3" type="radio" name="skip3" required="required">
                          <label class="skip" name="skip" for="skip3">Skip?</label>
                        </div>
                </div>

                <div style>
                    <div id="four" class="statement"></div>
                        <!-- <div id = "four" class="ui-block-a"></div> this can be used if statement desired to left of buttons -->
                        <div class="ui-block-b">

                          <input class="guessed" id="guessed4" type="radio" name="guessed4" required="required">
                          <label class="ui-mobile" name="guessed" for="guessed4">Guessed?</label>
                        </div>
                        <div class="ui-block-c">
                          <input class="skip" id="skip4" type="radio" name="skip4" required="required">
                          <label class="skip" name="skip" for="skip4">Skip?</label>
                        </div>
                </div>

                <div style>
                    <div id="five" class="statement"></div>
                    <!-- <div id = "five" class="ui-block-a"></div> this can be used if statement desired to left of buttons -->
                    <div class="ui-block-b">

                      <input class="guessed" id="guessed5" type="radio" name="guessed5" required="required">
                      <label class="guessed" name="guessed" for="guessed5">Guessed?</label>
                    </div>
                    <div class="ui-block-c">
                      <input class="skip" id="skip5" type="radio" name="skip5" required="required">
                      <label class="skip" name="skip" for="skip5">Skip?</label>
                    </div>
                </div>
        </div> <!-- end first -->
    <!-- </fieldset> -->
        <div id="second">  <!-- style="display:none" -->

                <div style="height: auto">
                <div id="six" class="statement"></div> <!-- these first are not parents of radio buttons because of the grid formatting issue. This means they cannot be accessed via parentsUntil, but a div above them can -->
                    <!-- <div id = "one" class="ui-block-a"></div> this can be used if statement desired to left of buttons-->
                    <div class="ui-block-b">
                <!--| alternative class designation = <input class="radio-input" |-->
                      <input class="guessed" id="guessed6" type="radio" name="guessed6" required="required">
                      <label for="guessed6">Guessed?</label>
                    </div>
                    <div class="ui-block-c">
                      <input class="skip" id="skip6" type="radio" name="skip6" required="required">
                      <label for="skip6">Skip?</label>
                    </div>
                </div> <!-- nameless div necessary to avail of parentsUntil logic-->

                <div style="height: auto">
                    <div id="seven" class="statement"></div>
                    <!-- <div id = "two" class="ui-block-a"></div> this can be used if statement desired to left of buttons -->
                    <div class="ui-block-b">
                      <input class="guessed" id="guessed7" type="radio" name="guessed7" required="required">
                      <label class="ui-mobile" name="guessed" for="guessed7">Guessed?</label>
                    </div>
                    <div class="ui-block-c">
                      <input class="skip" id="skip7" type="radio" name="skip7" required="required">
                      <label class="skip" name="skip" for="skip7">Skip?</label>
                    </div>
                </div>

                <div style="height: auto">
                    <div id="eight" class="statement"></div>
                        <!-- <div id = "three" class="ui-block-a"></div> this can be used if statement desired to left of buttons -->
                        <div class="ui-block-b">

                          <input class="guessed" id="guessed8" type="radio" name="guessed8" required="required">
                          <label class="ui-mobile" name="guessed" for="guessed8">Guessed?</label>
                        </div>
                        <div class="ui-block-c">
                          <input class="skip" id="skip8" type="radio" name="skip8" required="required">
                          <label class="skip" name="skip" for="skip8">Skip?</label>
                        </div>
                </div>

                <div style="height: auto">
                    <div id="nine" class="statement"></div>
                        <!-- <div id = "four" class="ui-block-a"></div> this can be used if statement desired to left of buttons -->
                        <div class="ui-block-b">

                          <input class="guessed" id="guessed9" type="radio" name="guessed9" required="required">
                          <label class="ui-mobile" name="guessed" for="guessed9">Guessed?</label>
                        </div>
                        <div class="ui-block-c">
                          <input class="skip" id="skip9" type="radio" name="skip9" required="required">
                          <label class="skip" name="skip" for="skip9">Skip?</label>
                        </div>
                </div>

                <div style="height: auto">
                    <div id="ten" class="statement"></div>
                    <!-- <div id = "five" class="ui-block-a"></div> this can be used if statement desired to left of buttons -->
                    <div class="ui-block-b">

                      <input class="guessed" id="guessed10" type="radio" name="guessed10" required="required">
                      <label class="guessed" name="guessed" for="guessed10">Guessed?</label>
                    </div>
                    <div class="ui-block-c">
                      <input class="skip" id="skip10" type="radio" name="skip10" required="required">
                      <label class="skip" name="skip" for="skip10">Skip?</label>
                    </div>
                </div>
        </div> <!-- end flip -->
<!-- </fieldset> -->

</form>
</body>
</html>